name: Docker Build CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  ubuntu_image:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Add repos
      run: |
        echo "deb http://archive.ubuntu.com/ubuntu bionic main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
        echo "deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
        echo "deb http://archive.ubuntu.com/ubuntu bionic-backports main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
        echo "deb http://security.ubuntu.com/ubuntu bionic-security main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
        echo "deb http://archive.canonical.com/ubuntu bionic partner" | sudo tee -a /etc/apt/sources.list
    - name: Build Ubuntu docker xenial baseimage
      run: sudo ./ubuntu/ubuntu-baseimage xenial ${{ secrets.QUAYIOREPO }} ${{ secrets.QUAYIOUSER }} ${{ secrets.QUAYIOPWD }}
    - name: Build Ubuntu docker bionic baseimage
      run: sudo ./ubuntu/ubuntu-baseimage bionic ${{ secrets.QUAYIOREPO }} ${{ secrets.QUAYIOUSER }} ${{ secrets.QUAYIOPWD }}
    - name: Build Ubuntu docker focal baseimage
      run: sudo ./ubuntu/ubuntu-baseimage focal ${{ secrets.QUAYIOREPO }} ${{ secrets.QUAYIOUSER }} ${{ secrets.QUAYIOPWD }}
    - name: Completed image build
      run: echo "completed image build"

  centos_7_image:
    runs-on: ubuntu-latest
    container:
      image: quay.io/sreejithp/centos:7-dind-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build Centos 7 baseimage
        run: ./centos-7/centos-7-baseimage ${{ secrets.QUAYIOREPO }} ${{ secrets.QUAYIOUSER }} ${{ secrets.QUAYIOPWD }}
      - name: Completed image build
        run: echo "completed image build"
